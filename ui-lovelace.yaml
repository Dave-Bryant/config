resources:
  - type: module
    url: /hacsfiles/simple-thermostat/simple-thermostat.js
  - type: module
    url: /hacsfiles/canvas-gauge-card/canvas-gauge-card.js
  - type: module
    url: /hacsfiles/lovelace-card-templater/lovelace-card-templater.js
  - type: module
    url: /hacsfiles/lovelace-multiple-entity-row/multiple-entity-row.js
  - type: module
    url: /hacsfiles/button-card/button-card.js
  - type: module
    url: /hacsfiles/history-explorer-card/history-explorer-card.js
  - type: module
    url: /hacsfiles/bom-radar-card/bom-radar-card.js
  - type: module
    url: /hacsfiles/hass-swipe-navigation/swipe-navigation.js
  - type: module
    url: /hacsfiles/uptime-card/uptime-card.js
  - type: module
    url: /hacsfiles/apexcharts-card/apexcharts-card.js?v=2.0.1

no-top-header:
  card-mod-theme: no-top-header
  card-mod-root: |
    app-toolbar {
      display: none;
    }

swipe_nav:
  wrap: true
  animate: swipe
  prevent_default: true
  swipe_amount: 15

views:
  - title: Home
    background: var(--background-image)
    badges:
      - entity: binary_sensor.home_assistant_versions_update_available
        name: Update?
      - entity: person.david_bryant
      - entity: person.wendy_bryant
      - entity: group.bryant_family
      - entity: sun.sun
      - entity: sensor.front_camera_motion_cam
      - entity: light.garage_light_switch_on_off


    cards:

      - type: vertical-stack
        cards:
        - type: horizontal-stack
          cards:
            - type: 'custom:button-card'
              entity: light.osram_classic_a60_w_clear_lightify_bdd2040a_level_on_off

              icon: 'mdi:lightbulb'
              aspect_ratio: 1.5/1
              color: auto
              state:
                - value: 'on'
                  color: rgb(255, 255, 0)
              label: |
                [[[
                    var bri = (states['light.osram_classic_a60_w_clear_lightify_bdd2040a_level_on_off'].attributes.brightness / 254 * 100).toFixed(0);
                    if (isNaN(bri))
                      return 'Brightness: ' + '0' + '%';
                    else
                      return 'Brightness: ' + (bri ? bri : '0') + '%';
                ]]]
              show_label: true
              size: 30%
              styles:
                card:
                  - height: 60px
                  - font-size: 12px
            - type: 'custom:button-card'
              entity: light.osram_classic_a60_w_clear_lightify_db99050a_level_on_off
              icon: 'mdi:lightbulb'
              aspect_ratio: 1.5/1
              color: auto
              state:
                - value: 'on'
                  color: rgb(255, 255, 0)
              label: |
                [[[
                    var bri = (states['light.osram_classic_a60_w_clear_lightify_db99050a_level_on_off'].attributes.brightness / 254 * 100).toFixed(0);
                    if (isNaN(bri))
                      return 'Brightness: ' + '0' + '%';
                    else
                      return 'Brightness: ' + (bri ? bri : '0') + '%';
                ]]]
              show_label: true
              size: 30%
              styles:
                card:
                  - height: 60px
                  - font-size: 12px
            - type: 'custom:button-card'
              entity: light.osram_classic_a60_w_clear_lightify_e0f2030a_level_on_off
              icon: 'mdi:lightbulb'
              aspect_ratio: 1.5/1
              color: auto
              state:
                - value: 'on'
                  color: rgb(255, 255, 0)
              label: |
                [[[
                    var bri = (states['light.osram_classic_a60_w_clear_lightify_e0f2030a_level_on_off'].attributes.brightness / 254 * 100).toFixed(0);
                    if (isNaN(bri))
                      return 'Brightness: ' + '0' + '%';
                    else
                      return 'Brightness: ' + (bri ? bri : '0') + '%';
                ]]]
              show_label: true
              size: 30%
              styles:
                card:
                  - height: 60px
                  - font-size: 12px
        - type: horizontal-stack
          cards:
            - type: 'custom:button-card'
              entity: switch.upstairs_light
              name: Upstairs Lamp
              icon: 'mdi:lightbulb'
              aspect_ratio: 1.5/1
              color: auto
              state:
                - value: 'on'
                  color: rgb(255, 255, 0)

              show_label: true
              size: 30%
              styles:
                card:
                  - height: 60px
                  - font-size: 12px
            - type: 'custom:button-card'
              entity: switch.spare_switch
              name: Dining Room Lamp
              icon: 'mdi:lightbulb'
              aspect_ratio: 1.5/1
              color: auto
              state:
                - value: 'on'
                  color: rgb(255, 255, 0)
              show_label: true
              size: 30%
              styles:
                card:
                  - height: 60px
                  - font-size: 12px

      - type: entities
        entities:
          - media_player.samsung_q80_series_65
        title: Television



      - type: horizontal-stack
        cards:
          - type: custom:canvas-gauge-card
            entity: sensor.cpu_temperature
            card_height: 62
            gauge:
              type: "radial-gauge"
              title: CPU Temperature
              width: 110
              height: 110
              borderShadowWidth: 0
              borderOuterWidth: 0
              borderMiddleWidth: 0
              borderInnerWidth: 0
              minValue: 0
              maxValue: 100
              startAngle: 90
              ticksAngle: 180
              valueBox: false
              majorTicks:
                ["0", "10", "20", "30", "40", "50", "60", "70", "80", "90", "100"]
              minorTicks: 2
              strokeTicks: true
              highlights:
                [{ "from": 70, "to": 100, "color": "rgba(200, 50, 50, .75)" }]
              colorPlate: "#ddd"
              borders: false
              needleType: "arrow"
              needleWidth: 2
              needleCircleSize: 7
              needleCircleOuter: true
              needleCircleInner: false
              animationDuration: 1500
              animationRule: "linear"
          - type: custom:canvas-gauge-card
            entity: sensor.memory_use_percent
            card_height: 62
            gauge:
              type: "radial-gauge"
              title: Memory Usage (%)
              width: 110
              height: 110
              borderShadowWidth: 0
              borderOuterWidth: 0
              borderMiddleWidth: 0
              borderInnerWidth: 0
              minValue: 0
              maxValue: 100
              startAngle: 90
              ticksAngle: 180
              valueBox: false
              majorTicks:
                ["0", "10", "20", "30", "40", "50", "60", "70", "80", "90", "100"]
              minorTicks: 2
              strokeTicks: true
              highlights:
                [{ "from": 80, "to": 100, "color": "rgba(200, 50, 50, .75)" }]
              colorPlate: "#ddd"
              borders: false
              needleType: "arrow"
              needleWidth: 2
              needleCircleSize: 7
              needleCircleOuter: true
              needleCircleInner: false
              animationDuration: 1500
              animationRule: "linear"
          - type: custom:canvas-gauge-card
            entity: sensor.processor_use
            card_height: 62
            gauge:
              type: "radial-gauge"
              title: Processor Usage (%)
              width: 110
              height: 110
              borderShadowWidth: 0
              borderOuterWidth: 0
              borderMiddleWidth: 0
              borderInnerWidth: 0
              minValue: 0
              maxValue: 100
              startAngle: 90
              ticksAngle: 180
              valueBox: false
              majorTicks:
                ["0", "10", "20", "30", "40", "50", "60", "70", "80", "90", "100"]
              minorTicks: 2
              strokeTicks: true
              highlights:
                [{ "from": 80, "to": 100, "color": "rgba(200, 50, 50, .75)" }]
              colorPlate: "#ddd"
              borders: false
              needleType: "arrow"
              needleWidth: 2
              needleCircleSize: 7
              needleCircleOuter: true
              needleCircleInner: false
              animationDuration: 1500
              animationRule: "linear"

      - entity: climate.study
        sensors:
          - entity: sensor.study_humidity
            name: Humidity
        type: 'custom:simple-thermostat'
      - entity: climate.hollys_bedroom
        sensors:
          - entity: sensor.hollys_bedroom_humidity
            name: Humidity
        type: 'custom:simple-thermostat'
      - entity: climate.wendys_bedroom
        sensors:
          - entity: sensor.wendys_bedroom_humidity
            name: Humidity
        type: 'custom:simple-thermostat'
      - entity: climate.family_room
        sensors:
          - entity: sensor.family_room_humidity
            name: Humidity
        type: 'custom:simple-thermostat'
      - entities:
          - entity: sensor.speedtest_download
          - entity: sensor.speedtest_upload
          - entity: sensor.speedtest_ping
        show_header_toggle: false
        title: Network
        type: entities
      - type: entities
        entities:
          - sensor.auto_backup
        title: Snapshot
      - type: entities
        entities:
          - sensor.hp_officejet_pro_9020_series
          - sensor.hp_officejet_pro_9020_series_black_cartridge
          - sensor.hp_officejet_pro_9020_series_cyan_cartridge
          - sensor.hp_officejet_pro_9020_series_magenta_cartridge
          - sensor.hp_officejet_pro_9020_series_yellow_cartridge
        state_color: true
        title: Printer Status
      - type: entities
        entities:
          - sensor.act_garbage_last_updated
          - sensor.act_garbage_pickup
          - sensor.act_recycling_pickup
          - sensor.act_greenwaste_pickup
          - input_boolean.check_act_garbage
          - binary_sensor.act_garbage_today
          - binary_sensor.act_garbage_tomorrow
          - binary_sensor.act_recycling_today
          - binary_sensor.act_recycling_tomorrow
          - binary_sensor.act_greenwaste_today
          - binary_sensor.act_greenwaste_tomorrow
        title: ACT Garbage Collection
        show_header_toggle: false

  - title: Helium
    cards:
      - type: custom:uptime-card
        entity: sensor.shallow_marmalade_scorpion
        icon: mdi:router-wireless
        ok: online
        ko: offline
        ko_icon: mdi:router-wireless-off
        hours_to_show: 24
        status_adaptive_color: true
        color:
          icon: grey
        show:
          icon: true
          status: false
          timeline: true
          average: true
        title_adaptive_color: true
        name: Shallow Marmalade Scorpion
      - type: custom:apexcharts-card
        header:
          show: true
          title: Helium AUD
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.helium_wallet_value
            color: green
            type: line
            stroke_width: 4
            fill_raw: 'last'
            extend_to: false
            group_by:
              duration: 24h
              func: max
        graph_span: 7d
        span:
          end: day
      - type: custom:apexcharts-card
        header:
          title: '24 hr Growth in Wallet (AUD)'
          show: true
        series:
         # data from today
          - entity: sensor.helium_wallet_value
            fill_raw: 'last'
            group_by:
              duration: 24h
              func: max
         # data from yesterday offsetted to be displayed today
          - entity: sensor.helium_wallet_value
            fill_raw: 'last'
            group_by:
              duration: 24h
              func: max
            offset: -1d
        graph_span: 7d
        span:
          end: day


      - type: entities
        title: 'Helium Tokens available'
        entities:
           - entity: sensor.helium_wallet_today
             name: Wallet Today
             icon: 'mdi:cash'
           - entity: sensor.helium_wallet_weekly
             name: Wallet this Week
             icon: 'mdi:cash'
           - entity: sensor.helium_wallet_monthly
             name: Wallet this month
             icon: 'mdi:cash'
           - entity: sensor.helium_wallet_14rtp7ja84zcvwsu6nuf6kbbfwam3qezuulzgvypk1n3jpkdqqu
             name: Wallet Total
             icon: 'mdi:cash'

      # - type: custom:apexcharts-card
      #   header:
      #     show: true
      #     title: Total Helium Tokens
      #     show_states: true
      #     colorize_states: true
      #   series:
      #     - entity: sensor.helium_wallet_14rtp7ja84zcvwsu6nuf6kbbfwam3qezuulzgvypk1n3jpkdqqu
      #       name: Wallet Total
      #       stroke_width: 2
      #       extend_to: false
      #   graph_span: 60d
      #   span:
      #     end: day

      - type: custom:apexcharts-card
        all_series_config:
          float_precision: 3
        apex_config:
          yaxis:
            - seriesName: HNT
              decimalsInFloat: 0
            - seriesName: Helium
              show: false
        experimental:
          color_threshold: true
        graph_span: 7d
        span:
          end: day
        show:
          last_updated: true
        header:
          show: true
          show_states: true
          colorize_states: true
          title: Total HNT per day
        series:
          - entity: sensor.helium_wallet_today
            show:
              header_color_threshold: true
              extremas: true
            type: column
            name: Today
            group_by:
              func: last
              duration: 1d
          - entity: sensor.helium_wallet_today
            name: Yesterday
            offset: '-1d'
            show:
              in_header: true
              in_chart: false

      - type: custom:apexcharts-card
        header:
          show: true
          title: Helium HNT/USD
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.helium_hnt_oracle_price
            stroke_width: 2
            extend_to: false
        graph_span: 7d
        span:
          end: day

      - type: iframe
        url: http://10.0.0.55:3000/api/hassio_ingress/3eZf1RWXgPHubUsGs2TsNUMhnzzV1lmAy0YAEJH4tS8/dashboard/snapshot/m5HMuP0mzTm8XqKLEHw2gebCRQe8wTgN?kiosk
        aspect_ratio: 85%

  - title: Irrigation
    cards:
      - type: entities
        title: 'Irrigation Status'
        entities:
          - entity: switch.frlawnwest
            icon: 'mdi:grass'
            type: custom:multiple-entity-row
            name: frlawnwest
            toggle: true
            state_color: true
            entities:
              - entity: input_text.frlawnwest_run_time
                name: run time
              - entity: input_text.frlawnwest_run_date
                name: run date
              - entity: input_text.frlawnwest_run_duration
                name: run dur.
                format: duration
          - entity: switch.frlawneast
            icon: 'mdi:grass'
            type: custom:multiple-entity-row
            name: frlawneast
            toggle: true
            state_color: true
            entities:
              - entity: input_text.frlawneast_run_time
                name: false
              - entity: input_text.frlawneast_run_date
                name: false
              - entity: input_text.frlawneast_run_duration
                name: false
                format: duration
          - entity: switch.bklawnsouth
            icon: 'mdi:grass'
            type: custom:multiple-entity-row
            name: bklawnsouth
            toggle: true
            state_color: true
            entities:
              - entity: input_text.bklawnsouth_run_time
                name: false
              - entity: input_text.bklawnsouth_run_date
                name: false
              - entity: input_text.bklawnsouth_run_duration
                name: false
                format: duration
          - entity: switch.bklawnnorth
            icon: 'mdi:grass'
            type: custom:multiple-entity-row
            name: bklawnnorth
            toggle: true
            state_color: true
            entities:
              - entity: input_text.bklawnnorth_run_time
                name: false
              - entity: input_text.bklawnnorth_run_date
                name: false
              - entity: input_text.bklawnnorth_run_duration
                name: false
                format: duration
          - type: section
          - entity: switch.frontgarden
            icon: 'mdi:water-pump'
            type: custom:multiple-entity-row
            name: frontgarden
            toggle: true
            state_color: true
            entities:
              - entity: input_text.frontgarden_run_time
                name: false
              - entity: input_text.frontgarden_run_date
                name: false
              - entity: input_text.frontgarden_run_duration
                name: false
                format: duration
          - entity: switch.backsidegarden
            icon: 'mdi:water-pump'
            type: custom:multiple-entity-row
            name: backsidegarden
            toggle: true
            state_color: true
            entities:
              - entity: input_text.backsidegarden_run_time
                name: false
              - entity: input_text.backsidegarden_run_date
                name: false
              - entity: input_text.backsidegarden_run_duration
                name: false
                format: duration
          - entity: switch.tinybacklawn
            icon: 'mdi:water-pump-off'
            type: custom:multiple-entity-row
            name: tinybacklawn
            toggle: true
            state_color: true
            entities:
              - entity: input_text.tinybacklawn_run_time
                name: false
              - entity: input_text.tinybacklawn_run_date
                name: false
              - entity: input_text.tinybacklawn_run_duration
                name: false
                format: duration
          - type: section
          - entity: input_number.garden_watering_time
            #type: custom:multiple-entity-row
            #state_header: 'Garden'
            format: duration
            #entities:
          - entity: sensor.smart_irrigation_daily_adjusted_run_time
            name: Daily Adjusted Run Time
          #      attribute: adjusted_run_time_minutes
          - entity: sensor.smart_irrigation_hourly_adjusted_run_time
              #  attribute: adjusted_run_time_minutes
          - entity: input_select.irrigation_status
            #name: false
      - type: custom:apexcharts-card
        header:
          show: true
          title: Nett Precipitation & Temperature
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.smart_irrigation_hourly_netto_precipitation
            name: 'Precipitation - Evapotranspiration'
            color: blue
            type: line
            stroke_width: 2
            extend_to: false
            group_by:
              duration: 1d
              func: avg
          - entity: sensor.outdoor_temperature
            color: red
            type: line
            stroke_width: 2
            extend_to: false
        graph_span: 28d
        span:
          end: day
      - type: entities
        title: 'Force Irrigation'
        entities:
          - entity: input_boolean.force_irrigation
            type: custom:multiple-entity-row
            name: Force irrigation
            state_header: 'Force'
            toggle: true
            format: duration
            entities:
              - attribute: force_mode_duration
                name: Force Mode Duration
                entity: sensor.smart_irrigation_daily_adjusted_run_time

      - type: entities
        title: 'Daily Forecast'
        entities:
          - entity: sensor.precip_chance_today # from REST PWS
            icon: 'mdi:weather-pouring'
          - entity: sensor.precip_chance_tomorrow # from REST PWS
            icon: 'mdi:weather-pouring'
          - sensor.daily_rain_rate_2 # correct
          - sensor.outdoor_temperature # Correct
          - sensor.wind_speed_2  # correct
          - sensor.humidity  # correct
          - sensor.relative_pressure # correct
          - sensor.dewpoint # correct
          - sensor.solar_radiation # correct
          - sensor.high_temperature_today # from config then Ecowitt
          - sensor.low_temperature_today

      - type: 'custom:card-templater'
        card:
          type: entities
          title: Weather Overview
          entities:
            - entity: sensor.pws_forecast_narrative_today
              icon: 'mdi:weather-sunny'
              name_template: >-
                {{ states("sensor.pws_forecast_narrative_today") | truncate(8,true,' ')
                }}
            - entity: sensor.pws_forecast_narrative_tonight
              icon: 'mdi:weather-night'
              name_template: >-
                {{ states("sensor.pws_forecast_narrative_tonight") | truncate(10,true,'
                ')  }}
            - entity: sensor.pws_forecast_narrative_tomorrow
              icon: 'mdi:weather-sunny'
              name_template: >-
                {{ states("sensor.pws_forecast_narrative_tomorrow") | truncate(11,true,'
                ')  }}
            - entity: sensor.pws_forecast_narrative_tomorrow_tonight
              icon: 'mdi:weather-night'
              name_template: >-
                {{ states("sensor.pws_forecast_narrative_tomorrow_tonight") |
                truncate(20,true,' ') }}
        entities:
          - entity: sensor.pws_forecast_narrative_today
            state_template: >-
              {% set first_word =  states("sensor.pws_forecast_narrative_today") |  truncate(8,true,' ')%}
              {% if first_word | trim  == 'Waiting' %}
              {{ states("sensor.pws_forecast_narrative_today") | truncate(8,true,' ') | trim }}
              {%- else -%}
              {{states("sensor.pws_forecast_narrative_today") | regex_replace(find='Today', replace=' ', ignorecase=False) }}
              {% endif %}
          - entity: sensor.pws_forecast_narrative_tonight
            state_template: >-
              {{ states("sensor.pws_forecast_narrative_tonight") |
              regex_replace(find='Tonight', replace=' ', ignorecase=False)   }}
          - entity: sensor.pws_forecast_narrative_tomorrow
            state_template: >-
              {{ states("sensor.pws_forecast_narrative_tomorrow") |
              regex_replace(find='Tomorrow', replace=' ', ignorecase=False)  }}
          - entity: sensor.pws_forecast_narrative_tomorrow_tonight
            state_template: >-
              {{ states("sensor.pws_forecast_narrative_tomorrow_tonight") |
              regex_replace(find='Tomorrow night', replace=' ', ignorecase=False)  }}
        entity: sensor.pws_forecast_narrative_tonight

      - type: 'custom:bom-radar-card'
        frame_count: 10
        center_latitude: -35.282000
        center_longitude: 149.1287
        show_marker: true
        show_range: true
        show_zoom: true
        show_recenter: true
        show_playback: true
        map_style: 'satellite'
        zoom_level: 8

  - title: Cameras
    cards:
      - type: picture-entity
        entity: camera.front_camera
        tap_action:
          action: call-service
          service: camera.snapshot
          service_data:
            entity_id: camera.front_camera
            filename: '/media/front_camera-{{ now().strftime("%Y-%m-%d-%H%M%S") }}.jpg'

      - type: picture-entity
        entity: camera.back_camera
        tap_action:
          action: call-service
          service: camera.snapshot
          service_data:
            entity_id: camera.back_camera
            filename: '/media/front_camera-{{ now().strftime("%Y-%m-%d-%H%M%S") }}.jpg'

  - title: History
    type: custom:history-explorer-card
    cardName: historycard-95223723
    recordedEntitiesOnly: true
    defaultTimeRange: 7d

  - title: Grafana
    cards:
      - type: iframe
        url: http://10.0.0.55:3000/api/hassio_ingress/3eZf1RWXgPHubUsGs2TsNUMhnzzV1lmAy0YAEJH4tS8/dashboard/snapshot/GcoR4m6EiZ5E3Aoe5379EyjuY4H0eM6L?orgId=1&kiosk
        aspect_ratio: 100%
      
    path: default_view
